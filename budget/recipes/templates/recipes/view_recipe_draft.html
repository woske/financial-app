{% extends 'recipes/base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{% if draft.imported %}View{% else %}Edit{% endif %} Recipe Draft</h1>
        <a href="{% url 'view_cookbook_drafts' draft.upload.id %}" class="btn btn-outline-secondary">← Back to Drafts</a>
    </div>
    
    <div class="row">
        <div class="col-md-8">
            {% if draft.imported %}
            <div class="alert alert-success">
                This recipe has been imported. <a href="{% url 'view_recipe' draft.imported_recipe.id %}">View Recipe →</a>
            </div>
            {% endif %}
            
            <form method="post">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="title" class="form-label">Recipe Title</label>
                    <input type="text" class="form-control" id="title" name="title" 
                           value="{{ draft.parsed_title }}" {% if draft.imported %}disabled{% endif %}>
                </div>
                
                <div class="mb-3">
                    <label for="ingredients" class="form-label">Ingredients (one per line)</label>
                    <textarea class="form-control" id="ingredients" name="ingredients" rows="10" 
                              {% if draft.imported %}disabled{% endif %}>{{ ingredients_text }}</textarea>
                </div>
                
                <div class="mb-3">
                    <label for="steps" class="form-label">Instructions/Steps (one per line)</label>
                    <textarea class="form-control" id="steps" name="steps" rows="10"
                              {% if draft.imported %}disabled{% endif %}>{{ steps_text }}</textarea>
                </div>
                
                {% if not draft.imported %}
                <hr>
                
                <div class="mb-3">
                    <label class="form-label">Add to Recipe Book (optional)</label>
                    <select class="form-select" name="recipe_book">
                        <option value="">-- None --</option>
                        {% for book in recipe_books %}
                        <option value="{{ book.id }}">{{ book.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="new_book_name" class="form-label">Or create new book</label>
                    <input type="text" class="form-control" id="new_book_name" name="new_book_name" 
                           placeholder="Enter new book name">
                </div>
                
                <div class="d-flex gap-2">
                    <button type="submit" name="action" value="save_draft" class="btn btn-secondary">Save Draft</button>
                    <button type="submit" name="action" value="import" class="btn btn-success">Import Recipe</button>
                </div>
                {% endif %}
            </form>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Draft Info</div>
                <div class="card-body">
                    <p><strong>Confidence:</strong> 
                        <span class="badge bg-{% if draft.confidence >= 0.8 %}success{% elif draft.confidence >= 0.5 %}warning{% else %}danger{% endif %}">
                            {{ draft.confidence|floatformat:0 }}%
                        </span>
                    </p>
                    <p><strong>Ingredients found:</strong> {{ draft.parsed_ingredients|length }}</p>
                    <p><strong>Steps found:</strong> {{ draft.parsed_steps|length }}</p>
                    
                    <hr>
                    <h6>Raw Text Preview</h6>
                    <pre class="small bg-light p-2" style="max-height: 300px; overflow-y: auto;">{{ draft.raw_text|truncatechars:1000 }}</pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
